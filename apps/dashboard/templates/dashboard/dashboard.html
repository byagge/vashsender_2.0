<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Дашборд - vashsender</title>
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Lucide Icons -->
    <script defer src="https://unpkg.com/lucide@0.276.0/dist/umd/lucide.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
        }

        .card-hover {
            transition: all 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        /* Улучшенные интерактивные элементы для сенсорных экранов */
        .touch-target {
            min-height: 44px;
            min-width: 44px;
        }

        .touch-friendly {
            padding: 0.75rem;
            margin: 0.25rem;
        }

        /* Улучшенные состояния для сенсорных устройств */
        @media (hover: none) and (pointer: coarse) {
            .card-hover:hover {
                transform: none;
                box-shadow: none;
            }
            
            .card-hover:active {
                transform: scale(0.98);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            }
            
            .button-gradient:hover {
                transform: none;
                box-shadow: none;
            }
            
            .button-gradient:active {
                transform: scale(0.95);
                box-shadow: 0 2px 4px rgba(37, 99, 235, 0.3);
            }
        }

        .stat-card {
            background: #ffffff;
            border: 1px solid #e5e7eb;
        }

        .chart-card {
            background: #ffffff;
            border: 1px solid #e5e7eb;
        }

        .button-gradient {
            background: #3B82F6;
            transition: all 0.3s ease;
        }

        .button-gradient:hover {
            background: #2563EB;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .nav-button {
            transition: all 0.2s ease;
        }

        .nav-button:hover {
            background: rgba(59, 130, 246, 0.1);
        }

        .stat-icon {
            background: rgba(59, 130, 246, 0.1);
        }

        .sidebar-pattern {
            position: absolute;
            inset: 0;
            opacity: 0.1;
        }

        .sidebar-pattern::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom right, #EBF5FF, #E0E7FF);
        }

        .sidebar-pattern::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 8rem;
            height: 8rem;
            background: linear-gradient(to bottom left, #DBEAFE, transparent);
            border-radius: 9999px;
            filter: blur(2rem);
        }

        .main-content {
            margin-left: 16rem; /* 64 * 4 = 256px (w-64) */
        }

        @media (max-width: 768px) {
            .main-content {
                margin-left: 0;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .period-selector {
                width: 100%;
                justify-content: center;
            }
            
            .header-actions {
                width: 100%;
                justify-content: center;
            }

            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            /* Улучшенные отступы для мобильных устройств */
            .main-content .p-4 {
                padding: 1rem;
            }

            .main-content .p-6 {
                padding: 1.25rem;
            }

            /* Адаптивные сетки для планшетов */
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
            }
            
            .templates-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
            }
            
            .quick-actions-grid {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
        }

        @media (max-width: 640px) {
            /* Мобильные устройства - одна колонка */
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .campaigns-grid {
                grid-template-columns: 1fr;
            }
            
            .templates-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            .quick-actions-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            /* Уменьшенные отступы для маленьких экранов */
            .main-content .p-4 {
                padding: 0.75rem;
            }

            .main-content .p-6 {
                padding: 1rem;
            }

            /* Улучшенные размеры кнопок для сенсорных экранов */
            .button-gradient {
                min-height: 44px;
                padding: 0.75rem 1rem;
            }

            /* Улучшенные размеры карточек */
            .stat-card, .chart-card {
                padding: 0.75rem;
            }

            /* Улучшенные размеры элементов навигации */
            .nav-button {
                min-height: 44px;
                padding: 0.75rem;
            }
        }

        @media (max-width: 480px) {
            /* Очень маленькие экраны */
            .main-content .p-4 {
                padding: 0.5rem;
            }

            .main-content .p-6 {
                padding: 0.75rem;
            }

            .stat-card, .chart-card {
                padding: 0.5rem;
            }

            /* Уменьшенные размеры текста для экономии места */
            .text-2xl {
                font-size: 1.5rem;
            }

            .text-xl {
                font-size: 1.25rem;
            }

            .text-lg {
                font-size: 1.125rem;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div x-data="dashboardApp()" class="min-h-screen">
        <!-- Sidebar -->
        {% include "dashboard/common/sidebar.html" %}

        <!-- Мобильное меню -->
        <div class="md:hidden fixed inset-0 bg-black/50 z-40" x-show="sidebarOpen" @click="sidebarOpen = false"></div>
        <aside class="md:hidden fixed inset-y-0 left-0 w-64 bg-white z-50 transform transition-transform duration-300" 
               :class="{'translate-x-0': sidebarOpen, '-translate-x-full': !sidebarOpen}"
               x-data="{ isAdmin: {% if is_admin %}true{% else %}false{% endif %} }">
            <!-- Фоновые паттерны -->
            <div class="sidebar-pattern"></div>
            <div class="relative z-10 flex flex-col h-full">
                <!-- Логотип / Бренд -->
                <div class="p-6 pb-4 flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <svg width="32" height="32" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="4" y="8" width="24" height="16" rx="4" fill="#1877ff"/>
                            <path d="M4 8l12 10L28 8" stroke="#fff" stroke-width="2"/>
                        </svg>
                        <h2 class="text-xl font-bold text-gray-800">vashsender</h2>
                        </div>
                    <button @click="sidebarOpen = false" class="p-3 rounded-lg hover:bg-gray-100 touch-target">
                        <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                    </button>
                </div>

                <!-- Навигация -->
                <nav class="flex-1 px-3 py-6 space-y-1">
                    <a href="/dashboard/" class="group flex items-center px-3 py-4 rounded-xl transition-all duration-200 hover:bg-blue-50 hover:scale-[1.02] touch-target" @click="sidebarOpen = false">
                        <div class="flex items-center justify-center w-8 h-8 rounded-lg mr-3 bg-blue-100">
                            <i data-lucide="layout-dashboard" class="w-4 h-4 text-blue-600"></i>
                        </div>
                        <span class="font-medium text-blue-700">Дашборд</span>
                        <div class="ml-auto">
                            <i data-lucide="chevron-right" class="w-4 h-4 text-blue-500"></i>
                        </div>
                    </a>
                    <a href="/lists/" class="group flex items-center px-3 py-4 rounded-xl transition-all duration-200 hover:bg-blue-50 hover:scale-[1.02] touch-target" @click="sidebarOpen = false">
                        <div class="flex items-center justify-center w-8 h-8 rounded-lg mr-3 group-hover:bg-blue-100 transition-colors duration-200">
                            <i data-lucide="users" class="w-4 h-4 text-gray-500 group-hover:text-blue-600"></i>
                        </div>
                        <span class="font-medium text-gray-700 group-hover:text-blue-700 transition-colors duration-200">Контакты</span>
                        <div class="ml-auto opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                            <i data-lucide="chevron-right" class="w-4 h-4 text-blue-500"></i>
                        </div>
                    </a>
                    <a href="/templates/" class="group flex items-center px-3 py-4 rounded-xl transition-all duration-200 hover:bg-blue-50 hover:scale-[1.02] touch-target" @click="sidebarOpen = false">
                        <div class="flex items-center justify-center w-8 h-8 rounded-lg mr-3 group-hover:bg-blue-100 transition-colors duration-200">
                            <i data-lucide="layout" class="w-4 h-4 text-gray-500 group-hover:text-blue-600"></i>
                        </div>
                        <span class="font-medium text-gray-700 group-hover:text-blue-700 transition-colors duration-200">Шаблоны</span>
                        <div class="ml-auto opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                            <i data-lucide="chevron-right" class="w-4 h-4 text-blue-500"></i>
                        </div>
                    </a>
                    <a href="/campaigns/" class="group flex items-center px-3 py-4 rounded-xl transition-all duration-200 hover:bg-blue-50 hover:scale-[1.02] touch-target" @click="sidebarOpen = false">
                        <div class="flex items-center justify-center w-8 h-8 rounded-lg mr-3 group-hover:bg-blue-100 transition-colors duration-200">
                            <i data-lucide="send" class="w-4 h-4 text-gray-500 group-hover:text-blue-600"></i>
                        </div>
                        <span class="font-medium text-gray-700 group-hover:text-blue-700 transition-colors duration-200">Рассылки</span>
                        <div class="ml-auto opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                            <i data-lucide="chevron-right" class="w-4 h-4 text-blue-500"></i>
                        </div>
                    </a>
                    <div class="h-px bg-gradient-to-r from-transparent via-gray-200 to-transparent my-4"></div>
                    <a href="/accounts/settings/" class="group flex items-center px-3 py-4 rounded-xl transition-all duration-200 hover:bg-blue-50 hover:scale-[1.02] touch-target" @click="sidebarOpen = false">
                        <div class="flex items-center justify-center w-8 h-8 rounded-lg mr-3 group-hover:bg-blue-100 transition-colors duration-200">
                            <i data-lucide="settings" class="w-4 h-4 text-gray-500 group-hover:text-blue-600"></i>
                        </div>
                        <span class="font-medium text-gray-700 group-hover:text-blue-700 transition-colors duration-200">Настройки</span>
                        <div class="ml-auto opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                            <i data-lucide="chevron-right" class="w-4 h-4 text-blue-500"></i>
                        </div>
                    </a>
                    <a href="/billing/" class="group flex items-center px-3 py-4 rounded-xl transition-all duration-200 hover:bg-blue-50 hover:scale-[1.02] touch-target" @click="sidebarOpen = false">
                        <div class="flex items-center justify-center w-8 h-8 rounded-lg mr-3 group-hover:bg-blue-100 transition-colors duration-200">
                            <i data-lucide="credit-card" class="w-4 h-4 text-gray-500 group-hover:text-blue-600"></i>
                        </div>
                        <span class="font-medium text-gray-700 group-hover:text-blue-700 transition-colors duration-200">Тарифы</span>
                        <div class="ml-auto opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                            <i data-lucide="chevron-right" class="w-4 h-4 text-blue-500"></i>
                        </div>
                    </a>
                    <a href="/support/" class="group flex items-center px-3 py-4 rounded-xl transition-all duration-200 hover:bg-blue-50 hover:scale-[1.02] touch-target" @click="sidebarOpen = false">
                        <div class="flex items-center justify-center w-8 h-8 rounded-lg mr-3 group-hover:bg-blue-100 transition-colors duration-200">
                            <i data-lucide="help-circle" class="w-4 h-4 text-gray-500 group-hover:text-blue-600"></i>
                        </div>
                        <span class="font-medium text-gray-700 group-hover:text-blue-700 transition-colors duration-200">Поддержка</span>
                        <div class="ml-auto opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                            <i data-lucide="chevron-right" class="w-4 h-4 text-blue-500"></i>
                        </div>
                    </a>
                    <a href="/support/chat/" class="group flex items-center px-3 py-4 rounded-xl transition-all duration-200 hover:bg-blue-50 hover:scale-[1.02] touch-target" @click="sidebarOpen = false">
                        <div class="flex items-center justify-center w-8 h-8 rounded-lg mr-3 group-hover:bg-blue-100 transition-colors duration-200">
                            <i data-lucide="message-circle" class="w-4 h-4 text-gray-500 group-hover:text-blue-600"></i>
                        </div>
                        <span class="font-medium text-gray-700 group-hover:text-blue-700 transition-colors duration-200">Чат поддержки</span>
                        <div class="ml-auto opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                            <i data-lucide="chevron-right" class="w-4 h-4 text-blue-500"></i>
                        </div>
                    </a>
                    
                    <!-- Административные страницы (только для админов) -->
                    <template x-if="isAdmin">
                        <div class="space-y-1 relative" x-data="{ adminMenuOpen: false }">
                            <!-- Кнопка для открытия/закрытия админ-меню -->
                            <div class="group flex items-center px-3 py-4 rounded-xl transition-all duration-200 hover:bg-blue-50 hover:scale-[1.02] cursor-pointer touch-target" @click="adminMenuOpen = !adminMenuOpen">
                                <div class="flex items-center justify-center w-8 h-8 rounded-lg mr-3 group-hover:bg-blue-100 transition-colors duration-200">
                                    <i data-lucide="shield" class="w-4 h-4 text-gray-500 group-hover:text-blue-600"></i>
                                </div>
                                <span class="font-medium text-gray-700 group-hover:text-blue-700 transition-colors duration-200">Администраторам</span>
                                <div class="ml-auto transition-transform duration-200" :class="{ 'rotate-90': adminMenuOpen }">
                                    <i data-lucide="chevron-right" class="w-4 h-4 text-blue-500"></i>
                                </div>
                            </div>
                            
                            <!-- Выпадающее админ-меню -->
                            <div x-show="adminMenuOpen" 
                                 x-transition:enter="transition ease-out duration-200"
                                 x-transition:enter-start="opacity-0 transform translate-y-2"
                                 x-transition:enter-end="opacity-100 transform translate-y-0"
                                 x-transition:leave="transition ease-in duration-150"
                                 x-transition:leave-start="opacity-100 transform translate-y-0"
                                 x-transition:leave-end="opacity-0 transform translate-y-2"
                                 class="absolute bottom-full left-0 right-0 mb-2 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50">
                                
                                <a href="/admin/" class="group flex items-center px-3 py-3 rounded-lg transition-all duration-200 hover:bg-blue-50 hover:scale-[1.01] touch-target" @click="sidebarOpen = false">
                                    <div class="flex items-center justify-center w-6 h-6 rounded-md mr-3 group-hover:bg-blue-100 transition-colors duration-200">
                                        <i data-lucide="shield" class="w-3 h-3 text-gray-500 group-hover:text-blue-600"></i>
                                    </div>
                                    <span class="text-sm font-medium text-gray-600 group-hover:text-blue-700 transition-colors duration-200">CMS</span>
                                </a>
                                
                                <a href="/django-admin/" class="group flex items-center px-3 py-3 rounded-lg transition-all duration-200 hover:bg-blue-50 hover:scale-[1.01] touch-target" @click="sidebarOpen = false">
                                    <div class="flex items-center justify-center w-6 h-6 rounded-md mr-3 group-hover:bg-blue-100 transition-colors duration-200">
                                        <i data-lucide="settings-2" class="w-3 h-3 text-gray-500 group-hover:text-blue-600"></i>
                                    </div>
                                    <span class="text-sm font-medium text-gray-600 group-hover:text-blue-700 transition-colors duration-200">Админ-панель</span>
                                </a>
                                
                                <a href="/moderation/" class="group flex items-center px-3 py-3 rounded-lg transition-all duration-200 hover:bg-blue-50 hover:scale-[1.01] touch-target" @click="sidebarOpen = false">
                                    <div class="flex items-center justify-center w-6 h-6 rounded-md mr-3 group-hover:bg-blue-100 transition-colors duration-200">
                                        <i data-lucide="shield-check" class="w-3 h-3 text-gray-500 group-hover:text-blue-600"></i>
                                    </div>
                                    <span class="text-sm font-medium text-gray-600 group-hover:text-blue-700 transition-colors duration-200">Модерация</span>
                                </a>
                                
                                <a href="/support/admin/" class="group flex items-center px-3 py-3 rounded-lg transition-all duration-200 hover:bg-blue-50 hover:scale-[1.01] touch-target" @click="sidebarOpen = false">
                                    <div class="flex items-center justify-center w-6 h-6 rounded-md mr-3 group-hover:bg-blue-100 transition-colors duration-200">
                                        <i data-lucide="headphones" class="w-3 h-3 text-gray-500 group-hover:text-blue-600"></i>
                                    </div>
                                    <span class="text-sm font-medium text-gray-600 group-hover:text-blue-700 transition-colors duration-200">Админ чата поддержки</span>
                                </a>
                            </div>
                        </div>
                    </template>
                </nav>

                <!-- Профиль пользователя -->
                <div class="mt-auto p-4 border-t border-gray-200 bg-gray-50/50" x-data="{ profileMenuOpen: false }">
                    <div class="relative">
                        <div class="flex items-center space-x-3 px-3 py-3 rounded-xl hover:bg-white/80 transition-all duration-200 cursor-pointer group touch-target" @click="profileMenuOpen = !profileMenuOpen">
                            <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center shadow-md">
                                <span class="text-white font-medium text-sm">
                                    {% if user.full_name %}
                                        {{ user.full_name|slice:":2"|upper }}
                                    {% else %}
                                        {{ user.email|slice:":2"|upper }}
                                    {% endif %}
                                </span>
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="text-gray-800 font-medium text-sm truncate">
                                    {% if user.full_name %}
                                        {{ user.full_name }}
                                    {% else %}
                                        {{ user.email }}
                                    {% endif %}
                                </p>
                                <p class="text-gray-500 text-xs truncate">{{ user.email }}</p>
                                {% if user.current_plan %}
                                    <p class="text-blue-600 text-xs truncate">{{ user.current_plan.title }}</p>
                                {% else %}
                                    <p class="text-gray-400 text-xs truncate">Бесплатный план</p>
                                {% endif %}
                            </div>
                            <button class="opacity-60 group-hover:opacity-100 transition-opacity duration-200">
                                <i data-lucide="chevron-down" class="w-4 h-4 text-gray-500"></i>
                            </button>
                        </div>
                        
                        <!-- Выпадающее меню профиля -->
                        <div x-show="profileMenuOpen" 
                             x-transition:enter="transition ease-out duration-200"
                             x-transition:enter-start="opacity-0 scale-95"
                             x-transition:enter-end="opacity-100 scale-100"
                             x-transition:leave="transition ease-in duration-150"
                             x-transition:leave-start="opacity-100 scale-100"
                             x-transition:leave-end="opacity-0 scale-95"
                             class="absolute bottom-full left-0 right-0 mb-2 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50">
                            
                            <a href="/accounts/settings/" class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 transition-colors touch-target" @click="sidebarOpen = false">
                                <i data-lucide="user" class="w-4 h-4 mr-3 text-gray-500"></i>
                                Профиль
                            </a>
                            
                            <a href="/accounts/settings/" class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 transition-colors touch-target" @click="sidebarOpen = false">
                                <i data-lucide="settings" class="w-4 h-4 mr-3 text-gray-500"></i>
                                Настройки
                            </a>
                            
                            <a href="/billing/" class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 transition-colors touch-target" @click="sidebarOpen = false">
                                <i data-lucide="credit-card" class="w-4 h-4 mr-3 text-gray-500"></i>
                                Управление тарифами
                            </a>
                            
                            <div class="border-t border-gray-100 my-1"></div>
                            
                            <a href="/accounts/logout/" class="flex items-center px-4 py-3 text-sm text-red-600 hover:bg-red-50 transition-colors touch-target" @click="sidebarOpen = false">
                                <i data-lucide="log-out" class="w-4 h-4 mr-3 text-red-500"></i>
                                Выйти
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Основной контент -->
        <div class="main-content">
            <!-- Header -->
            <header class="bg-white border-b border-gray-200 px-4 sm:px-6 py-4 sticky top-0 z-30 shadow-sm">
                <div class="flex items-center justify-between max-w-7xl mx-auto header-content">
                    <div class="flex items-center space-x-4">
                        <button @click="sidebarOpen = true" class="md:hidden p-3 rounded-lg hover:bg-gray-100 touch-target">
                            <i data-lucide="menu" class="w-5 h-5 text-gray-600"></i>
                        </button>
                        <h1 class="text-2xl font-bold text-gray-900">Dashboard</h1>
                        <!-- <div class="flex items-center space-x-2 bg-gray-100 rounded-lg p-1 period-selector">
                            <button 
                                x-on:click="selectedPeriod = '7d'" 
                                :class="{ 'bg-white text-blue-600 shadow-sm': selectedPeriod === '7d', 'text-gray-600 hover:text-gray-900': selectedPeriod !== '7d' }" 
                                class="px-3 py-1 rounded-md text-sm font-medium transition-all duration-200"
                            >7 дней</button>
                            <button 
                                x-on:click="selectedPeriod = '30d'" 
                                :class="{ 'bg-white text-blue-600 shadow-sm': selectedPeriod === '30d', 'text-gray-600 hover:text-gray-900': selectedPeriod !== '30d' }" 
                                class="px-3 py-1 rounded-md text-sm font-medium transition-all duration-200"
                            >30 дней</button>
                            <button 
                                x-on:click="selectedPeriod = '90d'" 
                                :class="{ 'bg-white text-blue-600 shadow-sm': selectedPeriod === '90d', 'text-gray-600 hover:text-gray-900': selectedPeriod !== '90d' }" 
                                class="px-3 py-1 rounded-md text-sm font-medium transition-all duration-200"
                            >90 дней</button>
                        </div> -->
                    </div>
                    <div class="flex items-center space-x-3 header-actions">
                        <!-- <button class="p-2 rounded-lg hover:bg-gray-100 transition-all duration-200">
                            <i data-lucide="bell" class="w-5 h-5 text-gray-600"></i>
                        </button> -->
                        <a href="/accounts/settings/" class="p-3 rounded-lg hover:bg-gray-100 transition-all duration-200 touch-target">
                            <i data-lucide="settings" class="w-5 h-5 text-gray-600"></i>
                        </a>
                        <a href="/campaigns/new/" class="button-gradient text-white px-4 py-3 rounded-lg flex items-center space-x-2 touch-target touch-friendly">
                            <i data-lucide="plus" class="w-4 h-4"></i>
                            <span class="hidden sm:inline">Создать рассылку</span>
                            <span class="sm:hidden">Создать</span>
                        </a>
                    </div>
                </div>
            </header>

            <!-- Основной контент -->
            <div class="p-3 sm:p-4 md:p-6 max-w-7xl mx-auto">
                <!-- Stats Overview -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-6 stats-grid">
                    <template x-for="stat in stats">
                        <div class="stat-card rounded-lg p-3 sm:p-4 card-hover touch-friendly">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-xs font-medium text-gray-600 mb-1" x-text="stat.label"></p>
                                    <p class="text-lg font-bold text-gray-900" x-text="stat.value"></p>
                                </div>
                                <div class="stat-icon p-2 rounded-lg">
                                    <i :data-lucide="stat.icon" class="w-4 h-4 text-blue-600"></i>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>

                <!-- Plan Information -->
                <div x-show="planInfo" class="mb-6">
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-200">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
                                    <i data-lucide="credit-card" class="w-4 h-4 text-blue-600"></i>
                                </div>
                                <div>
                                    <h3 class="text-base font-semibold text-gray-900" x-text="planInfo?.plan_name || 'Бесплатный тариф'"></h3>
                                    <p class="text-xs text-gray-600" x-text="planInfo?.plan_type === 'Letters' ? 'Тариф с лимитом писем' : 'Тариф с лимитом подписчиков'"></p>
                                </div>
                            </div>
                            <a href="/billing/" class="text-blue-600 hover:text-blue-700 text-xs font-medium flex items-center space-x-1 transition-colors">
                                <span>Управление</span>
                                <i data-lucide="chevron-right" class="w-3 h-3"></i>
                            </a>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                            <!-- Для тарифов с письмами -->
                            <template x-if="planInfo?.plan_type === 'Letters'">
                                <div class="space-y-3">
                                    <div class="bg-white rounded-lg p-3 border border-blue-100">
                                        <div class="flex items-center justify-between mb-2">
                                            <span class="text-xs font-medium text-gray-600">Остаток писем</span>
                                            <span class="text-xs text-gray-500" x-text="`${planInfo?.emails_sent || 0} / ${planInfo?.emails_limit || 0}`"></span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-1.5">
                                            <div class="bg-blue-600 h-1.5 rounded-full transition-all duration-300" 
                                                 :style="`width: ${Math.min(100, ((planInfo?.emails_sent || 0) / (planInfo?.emails_limit || 1)) * 100)}%`"></div>
                                        </div>
                                        <p class="text-sm font-bold text-gray-900 mt-1" x-text="`${planInfo?.emails_remaining || 0} писем осталось`"></p>
                                    </div>
                                </div>
                            </template>
                            
                            <!-- Для тарифов с подписчиками -->
                            <template x-if="planInfo?.plan_type === 'Subscribers'">
                                <div class="space-y-3">
                                    <div class="bg-white rounded-lg p-3 border border-blue-100">
                                        <div class="flex items-center justify-between mb-2">
                                            <span class="text-xs font-medium text-gray-600">Дней до истечения</span>
                                        </div>
                                        <p class="text-sm font-bold text-gray-900" x-text="`${planInfo?.days_remaining || 0} дней`"></p>
                                        <p class="text-xs text-gray-500" x-text="planInfo?.is_expired ? 'Тариф истёк' : 'Активен'"></p>
                                    </div>
                                </div>
                            </template>
                            
                            <!-- Общая информация -->
                            <div class="bg-white rounded-lg p-3 border border-blue-100">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-xs font-medium text-gray-600">Отправлено сегодня</span>
                                </div>
                                <p class="text-sm font-bold text-gray-900" x-text="`${planInfo?.emails_sent_today || 0} писем`"></p>
                                <p class="text-xs text-gray-500" x-text="planInfo?.has_exceeded_daily_limit ? 'Лимит превышен' : 'В пределах лимита'"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Templates Section - moved right after plan info -->
                <div class="mb-6 chart-card rounded-lg p-3 sm:p-4 card-hover touch-friendly">
                    <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4 gap-3">
                        <h3 class="text-base font-semibold text-gray-900">Ваши шаблоны</h3>
                        <a href="/templates/" class="text-blue-600 hover:text-blue-700 text-xs font-medium flex items-center space-x-1 transition-colors">
                            <span>Все шаблоны</span>
                            <i data-lucide="chevron-right" class="w-3 h-3"></i>
                        </a>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3 templates-grid">
                        <template x-if="templates.length === 0">
                            <div class="col-span-full flex flex-col items-center justify-center py-8 px-4 text-center">
                                <div class="w-12 h-12 bg-blue-50 rounded-full flex items-center justify-center mb-3">
                                    <i data-lucide="layout" class="w-6 h-6 text-blue-500"></i>
                                </div>
                                <h4 class="text-sm font-medium text-gray-900 mb-1">Нет шаблонов</h4>
                                <p class="text-xs text-gray-600 mb-4 max-w-sm">Создайте свой первый шаблон для быстрого создания email-рассылок</p>
                                <a href="/templates/" class="button-gradient text-white px-4 py-1.5 rounded-lg flex items-center space-x-1 text-sm">
                                    <i data-lucide="plus" class="w-3 h-3"></i>
                                    <span>Создать шаблон</span>
                                </a>
                            </div>
                        </template>
                        <template x-for="template in templates.slice(0, 4)">
                            <div class="border border-gray-200 rounded-lg p-3 hover:border-blue-300 hover:shadow-md transition-all cursor-pointer card-hover">
                                <div class="flex items-start justify-between mb-2">
                                    <div class="w-8 h-8 gradient-bg rounded-lg flex items-center justify-center">
                                        <i data-lucide="mail" class="w-4 h-4 text-white"></i>
                                    </div>
                                    <button class="p-1 rounded hover:bg-gray-100 transition-colors">
                                        <i data-lucide="more-vertical" class="w-3 h-3 text-gray-400"></i>
                                    </button>
                                </div>
                                <h4 class="text-sm font-medium text-gray-900 mb-1" x-text="template.name"></h4>
                                <p class="text-xs text-gray-500" x-text="'Использован ' + template.lastUsed"></p>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Quick Actions & Contact Lists -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4 mb-6 quick-actions-grid">
                    <!-- Quick Actions -->
                    <div class="chart-card rounded-lg p-3 sm:p-4 card-hover touch-friendly">
                        <h3 class="text-base font-semibold text-gray-900 mb-3">Быстрые действия</h3>
                        <div class="space-y-2">
                            <a href="/templates/" class="w-full text-left p-4 rounded-lg border border-gray-200 hover:border-blue-300 hover:bg-blue-50 transition-all group block touch-target">
                                <div class="flex items-start space-x-3">
                                    <div class="p-2 rounded-lg bg-blue-50 group-hover:bg-blue-100 transition-colors">
                                        <i data-lucide="layout" class="w-4 h-4 text-blue-600"></i>
                                    </div>
                                    <div>
                                        <h4 class="text-sm font-medium text-gray-900 mb-1">Новый шаблон</h4>
                                        <p class="text-xs text-gray-600">Создать дизайн письма</p>
                                    </div>
                                </div>
                            </a>
                            <a href="/lists/" class="w-full text-left p-4 rounded-lg border border-gray-200 hover:border-blue-300 hover:bg-blue-50 transition-all group block touch-target">
                                <div class="flex items-start space-x-3">
                                    <div class="p-2 rounded-lg bg-blue-50 group-hover:bg-blue-100 transition-colors">
                                        <i data-lucide="user-plus" class="w-4 h-4 text-blue-600"></i>
                                    </div>
                                    <div>
                                        <h4 class="text-sm font-medium text-gray-900 mb-1">Импорт контактов</h4>
                                        <p class="text-xs text-gray-600">Загрузить CSV файл</p>
                                    </div>
                                </div>
                            </a>
                            <a href="/campaigns/new/" class="w-full text-left p-4 rounded-lg border border-gray-200 hover:border-blue-300 hover:bg-blue-50 transition-all group block touch-target">
                                <div class="flex items-start space-x-3">
                                    <div class="p-2 rounded-lg bg-blue-50 group-hover:bg-blue-100 transition-colors">
                                        <i data-lucide="mail" class="w-4 h-4 text-blue-600"></i>
                                    </div>
                                    <div>
                                        <h4 class="text-sm font-medium text-gray-900 mb-1">Создать рассылку</h4>
                                        <p class="text-xs text-gray-600">Новая email рассылка</p>
                                    </div>
                                </div>
                            </a>
                            <a href="/campaigns/" class="w-full text-left p-4 rounded-lg border border-gray-200 hover:border-blue-300 hover:bg-blue-50 transition-all group block touch-target">
                                <div class="flex items-start space-x-3">
                                    <div class="p-2 rounded-lg bg-blue-50 group-hover:bg-blue-100 transition-colors">
                                        <i data-lucide="trending-up" class="w-4 h-4 text-blue-600"></i>
                                    </div>
                                    <div>
                                        <h4 class="text-sm font-medium text-gray-900 mb-1">Отчеты</h4>
                                        <p class="text-xs text-gray-600">Просмотр аналитики</p>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                    
                    <!-- Contact Lists -->
                    <div class="chart-card rounded-lg p-3 sm:p-4 card-hover touch-friendly">
                        <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-3 gap-3">
                            <h3 class="text-base font-semibold text-gray-900">Списки контактов</h3>
                            <a href="/lists/" class="text-blue-600 hover:text-blue-700 text-xs font-medium">Все списки</a>
                        </div>
                        <div class="space-y-2">
                            <template x-if="contactLists.length === 0">
                                <div class="flex flex-col items-center justify-center py-6 px-4 text-center">
                                    <div class="w-10 h-10 bg-blue-50 rounded-full flex items-center justify-center mb-2">
                                        <i data-lucide="users" class="w-5 h-5 text-blue-500"></i>
                                    </div>
                                    <h4 class="text-xs font-medium text-gray-900 mb-1">Нет списков</h4>
                                    <p class="text-xs text-gray-600 mb-3">Импортируйте контакты для создания рассылок</p>
                                    <a href="/lists/" class="text-blue-600 hover:text-blue-700 text-xs font-medium">Импортировать</a>
                                </div>
                            </template>
                            <template x-for="list in contactLists">
                                <div class="flex items-center justify-between p-2 border border-gray-100 rounded-lg hover:bg-gray-50 transition-colors">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-1.5 h-1.5 rounded-full bg-green-500"></div>
                                        <div>
                                            <h4 class="font-medium text-gray-900 text-xs" x-text="list.name"></h4>
                                            <p class="text-xs text-gray-600" x-text="list.contacts + ' контактов'"></p>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- Recent Campaigns -->
                <div class="mb-6 chart-card rounded-lg p-3 sm:p-4 card-hover touch-friendly">
                    <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4 gap-3">
                        <h3 class="text-base font-semibold text-gray-900">Недавние рассылки</h3>
                        <a href="/campaigns/" class="text-blue-600 hover:text-blue-700 text-xs font-medium flex items-center space-x-1 transition-colors">
                            <span>Все рассылки</span>
                            <i data-lucide="chevron-right" class="w-3 h-3"></i>
                        </a>
                    </div>
                    <div class="min-h-[150px]">
                        <template x-if="campaigns.length === 0">
                            <div class="flex flex-col items-center justify-center py-8 px-4 text-center">
                                <div class="w-12 h-12 bg-blue-50 rounded-full flex items-center justify-center mb-3">
                                    <i data-lucide="mail" class="w-6 h-6 text-blue-500"></i>
                                </div>
                                <h4 class="text-sm font-medium text-gray-900 mb-1">Нет рассылок</h4>
                                <p class="text-xs text-gray-600 mb-4 max-w-sm">Создайте свою первую email-рассылку, чтобы начать работу с платформой</p>
                                <a href="/campaigns/new/"><button class="button-gradient text-white px-4 py-1.5 rounded-lg flex items-center space-x-1 text-sm">
                                    <i data-lucide="plus" class="w-3 h-3"></i>
                                    <span>Создать рассылку</span>
                                </button></a>
                            </div>
                        </template>
                        <template x-if="campaigns.length > 0">
                            <div class="space-y-2">
                                <template x-for="campaign in campaigns.slice(0, 6)">
                                    <div class="flex flex-col sm:flex-row sm:items-center justify-between p-3 border border-gray-100 rounded-lg hover:bg-gray-50 transition-colors">
                                        <div class="flex items-center space-x-3 mb-3 sm:mb-0">
                                            <div class="w-2 h-2 rounded-full" :class="{
                                                'bg-green-500': campaign.status === 'completed',
                                                'bg-blue-500': campaign.status === 'draft',
                                                'bg-yellow-500': campaign.status === 'scheduled',
                                                'bg-gray-400': campaign.status === 'cancelled'
                                            }"></div>
                                            <div>
                                                <h4 class="text-sm font-medium text-gray-900" x-text="campaign.name"></h4>
                                                <p class="text-xs text-gray-600" x-text="campaign.date"></p>
                                            </div>
                                        </div>
                                        <div class="grid grid-cols-3 gap-3 sm:gap-4 text-xs text-gray-600">
                                            <div class="text-center">
                                                <p class="font-medium text-gray-900" x-text="campaign.sent"></p>
                                                <p class="text-xs">Отправлено</p>
                                            </div>
                                            <div class="text-center">
                                                <p class="font-medium text-gray-900" x-text="campaign.opened"></p>
                                                <p class="text-xs">Открыто</p>
                                            </div>
                                            <div class="text-center">
                                                <p class="font-medium text-gray-900" x-text="campaign.clicked"></p>
                                                <p class="text-xs">Клики</p>
                                            </div>
                                        </div>
                                        <!-- <div class="hidden sm:block">
                                            <div class="relative" x-data="{ open: false }">
                                                <button @click="open = !open" class="p-1 rounded hover:bg-gray-200 transition-colors">
                                                    <i data-lucide="more-vertical" class="w-3 h-3"></i>
                                                </button>
                                                <div x-show="open" @click.away="open = false" 
                                                     class="absolute right-0 mt-1 w-32 bg-white rounded-lg shadow-lg border border-gray-200 z-10">
                                                    <a href="#" class="block px-3 py-2 text-xs text-gray-700 hover:bg-gray-50">Редактировать</a>
                                                    <a href="#" class="block px-3 py-2 text-xs text-gray-700 hover:bg-gray-50">Дублировать</a>
                                                    <a href="#" class="block px-3 py-2 text-xs text-red-600 hover:bg-red-50">Удалить</a>
                                                </div>
                                            </div>
                                        </div> -->
                                    </div>
                                </template>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Ваши электронные почты -->
                <div class="mb-6 chart-card rounded-lg p-3 sm:p-4 card-hover touch-friendly">
                    <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4 gap-3">
                        <h3 class="text-base font-semibold text-gray-900">Ваши электронные почты</h3>
                        <a href="/emails/" class="text-blue-600 hover:text-blue-700 text-xs font-medium flex items-center space-x-1 transition-colors">
                            <span>Управление</span>
                            <i data-lucide="chevron-right" class="w-3 h-3"></i>
                        </a>
                    </div>
                    <div class="space-y-2">
                        <template x-for="email in emails">
                            <a href="/emails/" class="flex items-center justify-between p-3 border border-gray-100 rounded-lg hover:bg-gray-50 transition-colors">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-blue-50 rounded-lg flex items-center justify-center">
                                        <i data-lucide="mail" class="w-4 h-4 text-blue-600"></i>
                                    </div>
                                    <div>
                                        <h4 class="text-sm font-medium text-gray-900" x-text="email.address"></h4>
                                        <p class="text-xs text-gray-600" x-text="email.purpose"></p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <span class="text-xs text-green-600">Активен</span>
                                </div>
                            </a>
                        </template>
                        <a href="/emails/" class="flex items-center justify-between p-3 border border-gray-100 rounded-lg hover:bg-gray-50 transition-colors">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 bg-blue-50 rounded-lg flex items-center justify-center">
                                    <i data-lucide="plus" class="w-4 h-4 text-blue-600"></i>
                                </div>
                                <div>
                                    <h4 class="text-sm font-medium text-gray-900">Добавить почту</h4>
                                    <p class="text-xs text-gray-600">Подключить новый адрес</p>
                                </div>
                            </div>
                            <span class="text-blue-600 hover:text-blue-700 text-xs font-medium">
                                Добавить
                            </span>
                        </a>
                    </div>
                </div>

                <!-- Ваши домены -->
                <div class="mb-6 chart-card rounded-lg p-3 sm:p-4 card-hover touch-friendly">
                    <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4 gap-3">
                        <h3 class="text-base font-semibold text-gray-900">Ваши домены</h3>
                        <a href="/emails/" class="text-blue-600 hover:text-blue-700 text-xs font-medium flex items-center space-x-1 transition-colors">
                            <span>Управление</span>
                            <i data-lucide="chevron-right" class="w-3 h-3"></i>
                        </a>
                    </div>
                    <div class="space-y-2">
                        <template x-if="domains.length === 0">
                            <div class="flex flex-col items-center justify-center py-8 px-4 text-center">
                                <div class="w-12 h-12 bg-blue-50 rounded-full flex items-center justify-center mb-3">
                                    <i data-lucide="globe" class="w-6 h-6 text-blue-500"></i>
                                </div>
                                <h4 class="text-sm font-medium text-gray-900 mb-1">Нет доменов</h4>
                                <p class="text-xs text-gray-600 mb-4 max-w-sm">Добавьте свой первый домен для отправки email-рассылок</p>
                                <a href="/emails/" class="button-gradient text-white px-4 py-1.5 rounded-lg flex items-center space-x-1 text-sm">
                                    <i data-lucide="plus" class="w-3 h-3"></i>
                                    <span>Добавить домен</span>
                                </a>
                            </div>
                        </template>
                        <template x-if="domains.length > 0">
                            <div class="space-y-2">
                                <template x-for="domain in domains">
                                    <a href="/emails/" class="flex items-center justify-between p-3 border border-gray-100 rounded-lg hover:bg-gray-50 transition-colors">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-8 h-8 bg-blue-50 rounded-lg flex items-center justify-center">
                                                <i data-lucide="globe" class="w-4 h-4 text-blue-600"></i>
                                            </div>
                                            <div>
                                                <h4 class="text-sm font-medium text-gray-900" x-text="domain.domain"></h4>
                                                <p class="text-xs text-gray-600">Основной домен</p>
                                            </div>
                                        </div>
                                        <div class="flex items-center space-x-3">
                                            <span class="text-xs" :class="domain.isVerified ? 'text-green-600' : 'text-yellow-600'" x-text="domain.isVerified ? 'Проверен' : 'На проверке'"></span>
                                        </div>
                                    </a>
                                </template>
                                <a href="/emails/" class="flex items-center justify-between p-3 border border-gray-100 rounded-lg hover:bg-gray-50 transition-colors">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-8 h-8 bg-blue-50 rounded-lg flex items-center justify-center">
                                            <i data-lucide="plus" class="w-4 h-4 text-blue-600"></i>
                                        </div>
                                        <div>
                                            <h4 class="text-sm font-medium text-gray-900">Добавить домен</h4>
                                            <p class="text-xs text-gray-600">Подключить новый домен</p>
                                        </div>
                                    </div>
                                    <span class="text-blue-600 hover:text-blue-700 text-xs font-medium">
                                        Добавить
                                    </span>
                                </a>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Статистика по доменам -->
                <!--
                <div class="mt-8 chart-card rounded-xl p-4 sm:p-6 card-hover">
                    <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-6 gap-4">
                        <h3 class="text-lg font-semibold text-gray-900">Статистика по доменам</h3>
                        <div class="flex items-center space-x-2">
                            <button class="px-3 py-1 rounded-md text-sm font-medium bg-blue-50 text-blue-600">Неделя</button>
                            <button class="px-3 py-1 rounded-md text-sm font-medium text-gray-600 hover:bg-gray-100">Месяц</button>
                            <button class="px-3 py-1 rounded-md text-sm font-medium text-gray-600 hover:bg-gray-100">Год</button>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="border border-gray-100 rounded-lg p-4">
                            <h4 class="font-medium text-gray-900 mb-4">company.com</h4>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">Доставляемость</span>
                                    <span class="text-sm font-medium text-gray-900">98.5%</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">Открытия</span>
                                    <span class="text-sm font-medium text-gray-900">45.2%</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">Клики</span>
                                    <span class="text-sm font-medium text-gray-900">12.8%</span>
                                </div>
                            </div>
                        </div>
                        <div class="border border-gray-100 rounded-lg p-4">
                            <h4 class="font-medium text-gray-900 mb-4">shop.company.com</h4>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">Доставляемость</span>
                                    <span class="text-sm font-medium text-gray-900">97.8%</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">Открытия</span>
                                    <span class="text-sm font-medium text-gray-900">42.5%</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">Клики</span>
                                    <span class="text-sm font-medium text-gray-900">15.3%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                -->
            </div>
        </div>
    </div>

    <script type="text/javascript">
        // Получаем данные из Django
        const isAdmin = {{ is_admin|yesno:"true,false" }};
    </script>
    
    <script>
        // Инициализация иконок Lucide
        window.addEventListener('load', () => {
          if (typeof lucide !== 'undefined' && lucide.createIcons) {
            lucide.createIcons();
          }
        });

        function dashboardApp() {
            return {
                selectedPeriod: '7d',
                sidebarOpen: false,
                isAdmin: isAdmin,
                stats: [
                    {
                        label: 'Отправлено писем',
                        value: '0',
                        icon: 'mail'
                    },
                    {
                        label: 'Открыто писем',
                        value: '0',
                        icon: 'eye'
                    },
                    {
                        label: 'Переходы по ссылкам',
                        value: '0',
                        icon: 'mouse-pointer'
                    },
                    {
                        label: 'Новые подписчики',
                        value: '1,420',
                        icon: 'user-plus'
                    }
                ],
                campaigns: [],
                contactLists: [],
                templates: [],
                emails: [],
                domains: [],
                planInfo: null,
                activityChart: null,
                engagementChart: null,

                async init() {
                    await this.loadStats();
                    await this.loadPlanInfo();
                    await this.loadCampaigns();
                    await this.loadContactLists();
                    await this.loadTemplates();
                    await this.loadEmails();
                    await this.loadDomains();
                    // this.initCharts();
                    
                    // Инициализируем иконки после загрузки данных
                    this.$nextTick(() => {
                        if (typeof lucide !== 'undefined' && lucide.createIcons) {
                            lucide.createIcons();
                        }
                    });
                },

                async loadStats() {
                    try {
                        console.log('Fetching stats from API...');
                        const response = await fetch('/campaigns/api/campaigns/stats/');
                        const data = await response.json();
                        console.log('Raw API Response:', data);
                        
                        this.stats = [
                            {
                                label: 'Отправлено писем',
                                value: data.sent.toLocaleString(),
                                icon: 'mail'
                            },
                            {
                                label: 'Открыто писем',
                                value: data.opened.toLocaleString(),
                                icon: 'eye'
                            },
                            {
                                label: 'Переходы по ссылкам',
                                value: data.clicked.toLocaleString(),
                                icon: 'mouse-pointer'
                            },
                            {
                                label: 'Новые подписчики',
                                value: data.newSubscribers.toLocaleString(),
                                icon: 'user-plus'
                            }
                        ];
                        console.log('Processed Stats:', this.stats);
                        
                        // Обновляем иконки после загрузки статистики
                        this.$nextTick(() => {
                            if (typeof lucide !== 'undefined' && lucide.createIcons) {
                                lucide.createIcons();
                            }
                        });
                    } catch (error) {
                        console.error('Error loading stats:', error);
                        console.error('Error details:', error.message);
                        // Fallback values are already set in the initial state
                    }
                },

                async loadPlanInfo() {
                    try {
                        console.log('Fetching plan info from API...');
                        const response = await fetch('/billing/api/user-plan-info/');
                        const data = await response.json();
                        console.log('Plan info:', data);
                        
                        if (data.has_plan) {
                            this.planInfo = {
                                plan_name: data.plan_name,
                                plan_type: data.plan_type,
                                emails_sent: data.emails_sent,
                                emails_limit: data.emails_limit,
                                emails_remaining: data.emails_remaining,
                                days_remaining: data.days_remaining,
                                is_expired: data.is_expired,
                                emails_sent_today: data.emails_sent_today,
                                has_exceeded_daily_limit: data.has_exceeded_daily_limit
                            };
                        } else {
                            this.planInfo = null;
                        }
                    } catch (error) {
                        console.error('Error loading plan info:', error);
                        this.planInfo = null;
                    }
                },

                async loadCampaigns() {
                    try {
                        const response = await fetch('/campaigns/api/campaigns/');
                        const data = await response.json();
                        console.log('Campaigns API Response:', data);
                        
                        // API возвращает данные в формате {results: [...]}
                        const campaignsData = data.results || data;
                        this.campaigns = Array.isArray(campaignsData) ? campaignsData.slice(0, 6) : [];
                        this.campaigns = this.campaigns.map(campaign => ({
                            id: campaign.id,
                            name: campaign.name || 'Без названия',
                            date: new Date(campaign.created_at).toLocaleDateString('ru-RU'),
                            status: campaign.status,
                            sent: campaign.emails_sent ? campaign.emails_sent.toLocaleString() : '0',
                            opened: campaign.open_rate ? campaign.open_rate.toFixed(1) + '%' : '0%',
                            clicked: campaign.click_rate ? campaign.click_rate.toFixed(1) + '%' : '0%'
                        }));
                        
                        console.log('Processed Campaigns:', this.campaigns);
                        
                        // Обновляем иконки после загрузки кампаний
                        this.$nextTick(() => {
                            if (typeof lucide !== 'undefined' && lucide.createIcons) {
                                lucide.createIcons();
                            }
                        });
                    } catch (error) {
                        console.error('Error loading campaigns:', error);
                        console.error('Error details:', error.message);
                        // Устанавливаем пустой массив при ошибке
                        this.campaigns = [];
                    }
                },

                async loadContactLists() {
                    try {
                        const response = await fetch('/lists/api/contactlists/');
                        const data = await response.json();
                        console.log('Contact Lists API Response:', data);
                        
                        this.contactLists = Array.isArray(data) ? data.slice(0, 4) : [];
                        this.contactLists = this.contactLists.map(list => {
                            console.log('Processing list:', list);
                            return {
                                id: list.id,
                                name: list.name,
                                contacts: list.contacts_count || list.contacts?.length || 0
                            };
                        });
                        console.log('Processed Contact Lists:', this.contactLists);
                    } catch (error) {
                        console.error('Error loading contact lists:', error);
                        console.error('Error details:', error.message);
                    }
                },

                async loadTemplates() {
                    try {
                        const response = await fetch('/templates/api/templates/');
                        const data = await response.json();
                        console.log('Templates API Response:', data);
                        
                        this.templates = Array.isArray(data) ? data.slice(0, 4) : [];
                        this.templates = this.templates.map(template => {
                            console.log('Processing template:', template);
                            return {
                                id: template.id,
                                name: template.title || 'Без названия',
                                category: template.category || 'Без категории',
                                lastUsed: this.formatLastUsed(template.updated_at || template.created_at)
                            };
                        });
                        console.log('Processed Templates:', this.templates);
                    } catch (error) {
                        console.error('Error loading templates:', error);
                        console.error('Error details:', error.message);
                    }
                },

                async loadEmails() {
                    try {
                        const response = await fetch('/emails/api/emails/');
                        const data = await response.json();
                        this.emails = Array.isArray(data) ? data : [];
                        this.emails = this.emails.map(email => ({
                            id: email.id,
                            address: email.email,
                            purpose: email.purpose,
                            isActive: email.is_active
                        }));
                    } catch (error) {
                        console.error('Error loading emails:', error);
                    }
                },

                async loadDomains() {
                    try {
                        const response = await fetch('/emails/api/domains/');
                        const data = await response.json();
                        console.log('Domains API Response:', data);
                        
                        this.domains = Array.isArray(data) ? data : [];
                        this.domains = this.domains.map(domain => {
                            console.log('Processing domain:', domain);
                            return {
                                id: domain.id,
                                domain: domain.domain_name,
                                name: domain.domain_name,
                                purpose: 'Основной домен',
                                isVerified: domain.is_verified || false
                            };
                        });
                        console.log('Processed Domains:', this.domains);
                    } catch (error) {
                        console.error('Error loading domains:', error);
                        console.error('Error details:', error.message);
                    }
                },

                formatLastUsed(date) {
                    if (!date) return 'Никогда не использовался';
                    const lastUsed = new Date(date);
                    const now = new Date();
                    const diffDays = Math.floor((now - lastUsed) / (1000 * 60 * 60 * 24));
                    
                    if (diffDays === 0) return 'Сегодня';
                    if (diffDays === 1) return 'Вчера';
                    if (diffDays < 7) return `${diffDays} дней назад`;
                    if (diffDays < 30) return `${Math.floor(diffDays / 7)} недель назад`;
                    return `${Math.floor(diffDays / 30)} месяцев назад`;
                },

                getStatusColor(status) {
                    const colors = {
                        'active': 'bg-green-500',
                        'draft': 'bg-blue-500',
                        'scheduled': 'bg-yellow-500',
                        'completed': 'bg-gray-400'
                    };
                    return colors[status] || 'bg-gray-400';
                }
            };
        }
    </script>
</body>
</html>