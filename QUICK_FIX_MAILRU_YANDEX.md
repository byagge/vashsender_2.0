# üö® –ë–´–°–¢–†–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú –° –î–û–°–¢–ê–í–õ–Ø–ï–ú–û–°–¢–¨–Æ –í MAIL.RU –ò YANDEX

## –ü—Ä–æ–±–ª–µ–º–∞
–ü–∏—Å—å–º–∞ –ø–µ—Ä–µ—Å—Ç–∞–ª–∏ –¥–æ—Å—Ç–∞–≤–ª—è—Ç—å—Å—è –≤ Mail.ru –∏ Yandex –∏–∑-–∑–∞:
- –õ–æ–∫–∞–ª—å–Ω–æ–≥–æ SMTP —Å–µ—Ä–≤–µ—Ä–∞ –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏—è SPF/DMARC –∑–∞–ø–∏—Å–µ–π –≤ DNS
- –ü—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –ø–∏—Å–µ–º
- –í—ã—Å–æ–∫–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
- –û—Ç–∫–ª—é—á–µ–Ω–Ω–æ–π DKIM –ø–æ–¥–ø–∏—Å–∏

## ‚úÖ –£–ñ–ï –ò–°–ü–†–ê–í–õ–ï–ù–û –í –ö–û–î–ï

### 1. –£–¥–∞–ª–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –ø–∏—Å–µ–º
- –£–±—Ä–∞–Ω—ã `X-Mailer`, `X-Priority`, `X-MSMail-Priority`
- –£–±—Ä–∞–Ω—ã `Importance`, `List-Unsubscribe`, `Precedence`
- –û—Å—Ç–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏

### 2. –í–∫–ª—é—á–µ–Ω–∞ DKIM –ø–æ–¥–ø–∏—Å—å
- –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ —Å—Ç—Ä–æ–∫–∞ 835 –≤ `apps/campaigns/tasks.py`
- DKIM –ø–æ–¥–ø–∏—Å—å —Ç–µ–ø–µ—Ä—å –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–º –ø–∏—Å—å–º–∞–º

### 3. –£–º–µ–Ω—å—à–µ–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–∫–∏
- `EMAIL_BATCH_SIZE`: 100 ‚Üí 20 –ø–∏—Å–µ–º
- `EMAIL_RATE_LIMIT`: 50 ‚Üí 5 –ø–∏—Å–µ–º –≤ —Å–µ–∫—É–Ω–¥—É
- `EMAIL_RETRY_DELAY`: 60 ‚Üí 120 —Å–µ–∫—É–Ω–¥

### 4. –£–ª—É—á—à–µ–Ω—ã –∑–∞–¥–µ—Ä–∂–∫–∏
- –ú–µ–∂–¥—É –±–∞—Ç—á–∞–º–∏: 0.8-1.2—Å ‚Üí 1.5-2.5—Å
- –ú–µ–∂–¥—É –ø–∏—Å—å–º–∞–º–∏: 0.08-0.12—Å ‚Üí 0.15-0.25—Å

## üîß –ù–ï–ú–ï–î–õ–ï–ù–ù–´–ï –î–ï–ô–°–¢–í–ò–Ø

### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
```bash
cd /var/www/vashsender
python fix_mailru_yandex_deliverability.py
```

### –®–∞–≥ 2: –í—ã–±–µ—Ä–∏—Ç–µ –≤–Ω–µ—à–Ω–∏–π SMTP

#### –í–∞—Ä–∏–∞–Ω—Ç A: Yandex SMTP (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
1. –°–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç –Ω–∞ Yandex
2. –í–∫–ª—é—á–∏—Ç–µ SMTP –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
3. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:
```bash
EMAIL_HOST=smtp.yandex.ru
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=your-email@yandex.ru
EMAIL_HOST_PASSWORD=your-password
DEFAULT_FROM_EMAIL=your-email@yandex.ru
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: Mail.ru SMTP
1. –°–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç –Ω–∞ Mail.ru
2. –í–∫–ª—é—á–∏—Ç–µ SMTP –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
3. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:
```bash
EMAIL_HOST=smtp.mail.ru
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=your-email@mail.ru
EMAIL_HOST_PASSWORD=your-password
DEFAULT_FROM_EMAIL=your-email@mail.ru
```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ DNS –∑–∞–ø–∏—Å–∏

#### SPF –∑–∞–ø–∏—Å—å (TXT –¥–ª—è vashsender.ru):
```
"v=spf1 ip4:146.185.196.123 ~all"
```

#### DMARC –∑–∞–ø–∏—Å—å (TXT –¥–ª—è _dmarc.vashsender.ru):
```
"v=DMARC1; p=none; rua=mailto:dmarc@vashsender.ru; sp=none; adkim=r; aspf=r;"
```

#### MX –∑–∞–ø–∏—Å—å:
```
vashsender.ru. IN MX 10 mail.vashsender.ru.
mail.vashsender.ru. IN A 146.185.196.123
```

### –®–∞–≥ 4: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã
```bash
sudo systemctl stop celery
sudo systemctl stop celerybeat
redis-cli FLUSHALL
sudo systemctl restart postfix
sudo systemctl start celery
sudo systemctl start celerybeat
sudo systemctl restart gunicorn
```

### –®–∞–≥ 5: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ
```bash
python test_mailru_yandex_delivery.py
```

## üìã –ü–†–û–í–ï–†–ö–ê –†–ï–ó–£–õ–¨–¢–ê–¢–û–í

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS –∑–∞–ø–∏—Å–∏:
```bash
dig TXT vashsender.ru
dig TXT _dmarc.vashsender.ru
dig MX vashsender.ru
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
```bash
sudo tail -f /var/log/mail.log
sudo tail -f /var/log/celery.log
```

### 3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ:
```bash
python manage.py shell -c "
from apps.campaigns.tasks import send_campaign
from apps.campaigns.models import Campaign
campaign = Campaign.objects.filter(name='Test Delivery Campaign').first()
if campaign:
    send_campaign(campaign.id)
"
```

## ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø

### –°–∫–æ—Ä–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–∫–∏
- **–ù–ï –ø—Ä–µ–≤—ã—à–∞–π—Ç–µ 5 –ø–∏—Å–µ–º –≤ —Å–µ–∫—É–Ω–¥—É**
- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–∞—Ç—á–∏ –ø–æ 20 –ø–∏—Å–µ–º**
- **–î–æ–±–∞–≤–ª—è–π—Ç–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏**

### –ö–∞—á–µ—Å—Ç–≤–æ —Å–ø–∏—Å–∫–æ–≤
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–ø–∏—Å–∫–∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ
- –£–¥–∞–ª–∏—Ç–µ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∞–¥—Ä–µ—Å–∞
- –ò–∑–±–µ–≥–∞–π—Ç–µ —Å–ø–∞–º-–ª–æ–≤—É—à–µ–∫

### –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∏—Å–µ–º
- –ò–∑–±–µ–≥–∞–π—Ç–µ —Å–ø–∞–º-—Å–ª–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –î–æ–±–∞–≤–ª—è–π—Ç–µ —Å—Å—ã–ª–∫—É –¥–ª—è –æ—Ç–ø–∏—Å–∫–∏

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–æ—Å—Ç–∞–≤–ª—è–µ–º–æ—Å—Ç–∏
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–µ–ø—É—Ç–∞—Ü–∏—é IP –∏ –¥–æ–º–µ–Ω–∞
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∂–∞–ª–æ–±—ã –Ω–∞ —Å–ø–∞–º

## üÜò –ï–°–õ–ò –ü–†–û–ë–õ–ï–ú–´ –û–°–¢–ê–Æ–¢–°–Ø

### 1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã:
- **SendGrid** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- **Mailgun**
- **Amazon SES**

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ DKIM –∫–ª—é—á–∏:
```bash
python setup_dkim_for_deliverability.py
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–ø—É—Ç–∞—Ü–∏—é:
- https://mxtoolbox.com/blacklists.aspx
- https://senderbase.org/
- https://www.senderscore.org/

### 4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É:
- **Mail.ru**: https://postmaster.mail.ru/
- **–Ø–Ω–¥–µ–∫—Å**: https://yandex.ru/support/mail/spam-fighters/

## üìû –ö–û–ù–¢–ê–ö–¢–´ –î–õ–Ø –≠–ö–°–¢–†–ï–ù–ù–û–ô –ü–û–ú–û–©–ò

–ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç:
1. –°–æ–∑–¥–∞–π—Ç–µ issue –≤ GitHub
2. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å–µ—Ä–≤–µ—Ä–∞
3. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–º–µ–Ω—ã SMTP –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

---

**–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è**: $(date)
**–°—Ç–∞—Ç—É—Å**: –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π 